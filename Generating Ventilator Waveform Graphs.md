<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generating Ventilator Waveform Graphs</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="generating-mechanical-ventilator-waveform-graphs">Generating Mechanical Ventilator Waveform Graphs</h1>
<h2 id="introduction">Introduction</h2>
<p>Assisted ventilation can be total, partial or absent, depending on respiratory muscles’ ability to generate the pressure applied to the respiratory system (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_{rs}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>).</p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_{rs}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> of a ventilated patient is the sum of the pressure generated by the ventilator (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mrow><mi>a</mi><mi>w</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_{aw}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right: 0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>) and the pressure developed by the respiratory muscles ( <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mrow><mi>m</mi><mi>u</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_{mus}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>).</p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mrow><mi>m</mi><mi>u</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_{mus}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> is negative, as inspiratory muscles act by producing a decrease in pressure below the airways.</p>
<h2 id="inspiration">Inspiration</h2>
<p>During inspiration, the relationship between pressure, and flow is described by the equation of motion:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub><mo>=</mo><msub><mi>P</mi><mrow><mi>a</mi><mi>w</mi></mrow></msub><mo>+</mo><mo stretchy="false">(</mo><mo>−</mo><msub><mi>P</mi><mrow><mi>m</mi><mi>u</mi><mi>s</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mover accent="true"><mi>V</mi><mo>˙</mo></mover><mi>R</mi><mo>+</mo><mfrac><mi>V</mi><mi>C</mi></mfrac><mo>+</mo><mi>P</mi><mi>E</mi><mi>E</mi><mi>P</mi></mrow><annotation encoding="application/x-tex"> P_{rs} = P_{aw} + (-P_{mus}) = \dot{V}R + \frac{V}{C} + PEEP </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right: 0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00352em; vertical-align: -0.08333em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.92019em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span></span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.13889em;">˙</span></span></span></span></span></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.04633em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.36033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span></span></span></span></span></span></p>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span></span></span></span></span> is the volume, <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi>V</mi><mo>˙</mo></mover></mrow><annotation encoding="application/x-tex">\dot{V}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.92019em; vertical-align: 0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.92019em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span></span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.13889em;">˙</span></span></span></span></span></span></span></span></span></span> the flow over time, and <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mi>E</mi><mi>E</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">PEEP</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span></span></span></span></span> is a constant representing the alveolar end expiratory pressure.</p>
<ul>
<li>The term <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">FR</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span></span></span></span></span> corresponds to the pressure dissipated across the airway and the endotracheal tube, and to overcome the frictional forces generated with gas flow.</li>
<li>The term <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mi mathvariant="normal">/</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">V/C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mord">/</span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span></span></span></span></span> corresponds to the pressure that must be applied to overcome elastic forces of the lungs, and depends on both the volume that is in the lungs in excess on resting volume, and on the respiratory system compliance.</li>
</ul>
<h2 id="expiration">Expiration</h2>
<p>Expiration is passive, and the flow is described using the exponential decay equation which can be written as a differential equation, or a solution to that equation.<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi>V</mi><mo>˙</mo></mover><mo>=</mo><mo>−</mo><mi>λ</mi><mi>V</mi><mi>o</mi><mi>r</mi><mtext>&nbsp;</mtext><mi>V</mi><mo>=</mo><msub><mi>V</mi><mn>0</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><mi>λ</mi><mi>t</mi></mrow></msup><mo separator="true">,</mo><mi>w</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>e</mi></mrow><annotation encoding="application/x-tex"> \dot{V} = -\lambda V or\space  V= V_0 e^{-\lambda t}, where</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.92019em; vertical-align: 0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.92019em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span></span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.13889em;">˙</span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.77777em; vertical-align: -0.08333em;"></span><span class="mord">−</span><span class="mord mathdefault">λ</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mspace">&nbsp;</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.09355em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.899108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">λ</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span></span></span></span></span></span><br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>λ</mi><mo>=</mo><mfrac><mn>1</mn><mi>τ</mi></mfrac><mtext>&nbsp;</mtext><mo separator="true">,</mo><mi>a</mi><mi>n</mi><mi>d</mi><mtext>&nbsp;</mtext><mi>τ</mi><mo>=</mo><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi mathvariant="normal">.</mi><mi>R</mi><mi>e</mi><mi>s</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>=</mo><mo>−</mo><mi>V</mi><mi>o</mi><mi>l</mi><mi>u</mi><mi>m</mi><mi>e</mi><mi mathvariant="normal">/</mi><mi>F</mi><mi>l</mi><mi>o</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">\lambda={1\over\tau} \space, and \space \tau=Compliance.Resistance=-Volume / Flow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">λ</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.00744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.1132em;">τ</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace">&nbsp;</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mspace">&nbsp;</span><span class="mord mathdefault" style="margin-right: 0.1132em;">τ</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord mathdefault">o</span><span class="mord mathdefault">m</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">−</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">u</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord">/</span><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span></span></span></span></span></span></p>
<h2 id="approach-to-solution">Approach to solution</h2>
<h3 id="calculating-volume-during-inspiration-in-volume-ventilation">Calculating volume during inspiration in volume-ventilation</h3>
<p>Since flow is a known variable, the change of volume can be calculated as:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>V</mi><mo>=</mo><mi>F</mi><mi mathvariant="normal">.</mi><mi>d</mi><mi>t</mi><mo separator="true">,</mo><mi>a</mi><mi>n</mi><mi>d</mi><mtext>&nbsp;</mtext><mi>V</mi><mo>=</mo><msub><mi>V</mi><mn>0</mn></msub><mo>+</mo><mi>d</mi><mi>V</mi></mrow><annotation encoding="application/x-tex">dV = F . dt, and \space V = V_0 +dV</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="mord">.</span><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mspace">&nbsp;</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span></span></span></span></span></span></p>
<h3 id="calculating-volume-during-inspiration-in-pressure-ventilation">Calculating volume during inspiration in pressure-ventilation</h3>
<p>Flow is the derivative of volume <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo>=</mo><mover accent="true"><mi>V</mi><mo>˙</mo></mover><mo>=</mo><mfrac><mrow><mi>d</mi><mi>V</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">F = \dot{V} = {dV \over dt}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.92019em; vertical-align: 0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.92019em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span></span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.13889em;">˙</span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.22511em; vertical-align: -0.345em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.880108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">t</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight" style="margin-right: 0.22222em;">V</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span>. Rearranging the equation of motion above, we can solve for <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>V</mi></mrow><annotation encoding="application/x-tex">dV</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span></span></span></span></span>, and this allows us to calculate volume. Note that airway pressure is a know variable in pressure-ventilation:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>V</mi><mo>=</mo><mfrac><mrow><msub><mi>P</mi><mrow><mi>a</mi><mi>w</mi></mrow></msub><mo>−</mo><mi>V</mi><mi mathvariant="normal">/</mi><mi>C</mi><mo>−</mo><mi>P</mi><mi>E</mi><mi>E</mi><mi>P</mi></mrow><mi>R</mi></mfrac><mi mathvariant="normal">.</mi><mi>d</mi><mi>t</mi><mo separator="true">,</mo><mi>a</mi><mi>n</mi><mi>d</mi><mtext>&nbsp;</mtext><mi>V</mi><mo>=</mo><msub><mi>V</mi><mn>0</mn></msub><mo>+</mo><mi>d</mi><mi>V</mi></mrow><annotation encoding="application/x-tex"> dV = \frac{P_{aw} -V/C -PEEP}{R}.dt , and \space V = V_0 +dV</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.113em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right: 0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mord">/</span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">.</span><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mspace">&nbsp;</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span></span></span></span></span></span></p>
<h3 id="calculating-volume-in-expiration-for-both-volume-and-pressure-ventilation">Calculating volume in expiration for both volume, and pressure ventilation</h3>
<p>This is based on the natural decay equation:<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>V</mi><mo>=</mo><mo>−</mo><mfrac><mn>1</mn><mi>τ</mi></mfrac><mi>V</mi><mi mathvariant="normal">.</mi><mi>d</mi><mi>t</mi><mo separator="true">,</mo><mi>w</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>e</mi><mtext>&nbsp;</mtext><mi>τ</mi><mo>=</mo><mi>C</mi><mi mathvariant="normal">.</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">dV=-\frac{1}{\tau}V.dt, where\space {\tau} = C.R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.00744em; vertical-align: -0.686em;"></span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.1132em;">τ</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mord">.</span><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mspace">&nbsp;</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.1132em;">τ</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span></span></span></span></span></span></p>
<p>where <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>τ</mi></mrow><annotation encoding="application/x-tex">\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.1132em;">τ</span></span></span></span></span> (tau) is a constant that is the product of the compliance and resistance of the lungs <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>τ</mi><mo>=</mo><mi>C</mi><mi mathvariant="normal">.</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">\tau = C . R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.1132em;">τ</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span></span></span></span></span>.</p>
<p>Note that the same equation can be derived from the equation of motion by setting <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mi>a</mi><mi>w</mi><mo>=</mo><mi>P</mi><mi>E</mi><mi>E</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">paw = PEEP</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span></span></span></span></span>, and solving for <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>V</mi></mrow><annotation encoding="application/x-tex">dV</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span></span></span></span></span>.</p>
<h2 id="a-complete-solution-in-go">A complete solution in Go</h2>
<p>The following code represents a complete program in <a href="https://golang.org/">Go</a>. The compiled program can be used in command line to produce image files such as the ones shown below.</p>
<pre class=" language-go"><code class="prism  language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"math"</span>
	<span class="token string">"os"</span>
	<span class="token string">"strconv"</span>
	<span class="token string">"strings"</span>

	<span class="token string">"gonum.org/v1/plot"</span>
	<span class="token string">"gonum.org/v1/plot/plotter"</span>
	<span class="token string">"gonum.org/v1/plot/vg"</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> helpMessage <span class="token operator">=</span> <span class="token string">`
This program generates ventilator waveforms image files based on lung, and ventilator parameters provided by the query string
---Usage: vw par1=val1 par2=val2...
---Example: vw mode=VC TV=1 filename=mywaveform
---Parameters:
	R, resistance of the airways in cmH2O/L/sec
	C, compliance - the compliance of the lungs in L/cmH2O
	V0, the initial volume in the lungs in liters
	MODE, ventilator mode VC for volume-control, and PC for pressure control
	RR, respiratory rate per minute
	PI, inspiratory pressure in cmH2O
	TI, time for inspiration in seconds
	PEEP, posivtive end expiratory pressure in cmH2O
	TV, tial volume in liters
	FLOW, flow in liters per minute
	SQWAVE, flow waveform shape 1 for square or 0 for decelerating
	FILENAME, the name of the files that will hold the waveform images
`</span>

<span class="token keyword">const</span> duration <span class="token operator">=</span> <span class="token number">31</span> <span class="token comment">// simulation duration in seconds</span>
<span class="token keyword">const</span> dt <span class="token operator">=</span> <span class="token number">0.01</span>     <span class="token comment">// step width in seconds</span>
<span class="token keyword">const</span> dataPoints <span class="token operator">=</span> duration <span class="token operator">/</span> dt

<span class="token keyword">var</span> time<span class="token punctuation">,</span> paw<span class="token punctuation">,</span> palv<span class="token punctuation">,</span> flow<span class="token punctuation">,</span> volume <span class="token punctuation">[</span>dataPoints<span class="token punctuation">]</span><span class="token builtin">float64</span>

<span class="token comment">// Lung represents the properties of the respiratory system (lungs &amp; airways)</span>
<span class="token keyword">type</span> Lung <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Resistance<span class="token punctuation">,</span> Compliance<span class="token punctuation">,</span> V0 <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token comment">// VentPC represents the settings for a vent in a pressure-controlled setting</span>
<span class="token keyword">type</span> VentPC <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	RR<span class="token punctuation">,</span> Pi<span class="token punctuation">,</span> Ti<span class="token punctuation">,</span> PEEP <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token comment">// VentVC represents the settings for a vent in a pressure-controlled setting</span>
<span class="token keyword">type</span> VentVC <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	RR<span class="token punctuation">,</span> TV<span class="token punctuation">,</span> Flow<span class="token punctuation">,</span> SqWave<span class="token punctuation">,</span> PEEP <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token comment">// PARS default parameters which can be changed through command line arguments</span>
<span class="token keyword">var</span> PARS <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span>
	<span class="token string">"R"</span><span class="token punctuation">:</span>      <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token comment">// Resistance - resistance of the airways in cmH2O/L/sec</span>
	<span class="token string">"C"</span><span class="token punctuation">:</span>      <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token comment">// Compliance - the compliance of the lungs in L/cmH2O</span>
	<span class="token string">"V0"</span><span class="token punctuation">:</span>     <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token comment">// V0 - the initial volume in the lungs in liters</span>
	<span class="token string">"RR"</span><span class="token punctuation">:</span>     <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token comment">// RR - respiratory rate per minute</span>
	<span class="token string">"PI"</span><span class="token punctuation">:</span>     <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token comment">// Pi - inspiratory pressure in cmH2O</span>
	<span class="token string">"TI"</span><span class="token punctuation">:</span>     <span class="token number">1</span><span class="token punctuation">,</span>   <span class="token comment">// Ti - time for inspiration in seconds</span>
	<span class="token string">"PEEP"</span><span class="token punctuation">:</span>   <span class="token number">5</span><span class="token punctuation">,</span>   <span class="token comment">// PEEP - in cmH2O</span>
	<span class="token string">"TV"</span><span class="token punctuation">:</span>     <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">// TV - tial volume in liters</span>
	<span class="token string">"FLOW"</span><span class="token punctuation">:</span>   <span class="token number">60</span><span class="token punctuation">,</span>  <span class="token comment">// Flow - flow in liters per minute</span>
	<span class="token string">"SQWAVE"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>   <span class="token comment">// SqWave - flow waveform shape (square) or (decelerating)</span>
<span class="token punctuation">}</span>

<span class="token comment">// MODE default ventilator mode</span>
<span class="token keyword">var</span> MODE <span class="token operator">=</span> <span class="token string">"VC"</span>

<span class="token comment">// FILENAME name of files that will save images of waveforms</span>
<span class="token keyword">var</span> FILENAME <span class="token operator">=</span> <span class="token string">"Default"</span>

<span class="token comment">// SimulatePC takes a Vent, and Lung, and returns pressure, flow, and volume values</span>
<span class="token keyword">func</span> <span class="token function">SimulatePC</span><span class="token punctuation">(</span>vent VentPC<span class="token punctuation">,</span> lung Lung<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	breathTime <span class="token operator">:=</span> <span class="token number">60.0</span> <span class="token operator">/</span> vent<span class="token punctuation">.</span>RR
	volume<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> lung<span class="token punctuation">.</span>V0
	<span class="token keyword">for</span> t <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> dataPoints<span class="token number">-1</span><span class="token punctuation">;</span> t<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token comment">// calculate time</span>
		currentTime <span class="token operator">:=</span> <span class="token function">float64</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">*</span> dt
		timeInCycle <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Mod</span><span class="token punctuation">(</span>currentTime<span class="token punctuation">,</span> breathTime<span class="token punctuation">)</span>
		inspInCycle <span class="token operator">:=</span> timeInCycle <span class="token operator">&lt;</span> vent<span class="token punctuation">.</span>Ti
		time<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> currentTime
		<span class="token comment">// calculate airway pressure (Paw)</span>
		<span class="token comment">// it varies between the vent Pi pressure during inspiration and PEEP during expiration</span>
		<span class="token keyword">if</span> inspInCycle <span class="token punctuation">{</span>
			paw<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> vent<span class="token punctuation">.</span>Pi
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			paw<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> vent<span class="token punctuation">.</span>PEEP
		<span class="token punctuation">}</span>
		<span class="token comment">// calculate flow, and volume</span>
		dv <span class="token operator">:=</span> <span class="token punctuation">(</span>paw<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">-</span> volume<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">/</span>lung<span class="token punctuation">.</span>Compliance <span class="token operator">-</span> vent<span class="token punctuation">.</span>PEEP<span class="token punctuation">)</span> <span class="token operator">/</span> lung<span class="token punctuation">.</span>Resistance <span class="token operator">*</span> dt
		volume<span class="token punctuation">[</span>t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> volume<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">+</span> dv
		flow<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> dv <span class="token operator">/</span> dt
		<span class="token comment">// calculate alveolar pressure (Palv)</span>
		palv<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> volume<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">/</span>lung<span class="token punctuation">.</span>Compliance <span class="token operator">+</span> vent<span class="token punctuation">.</span>PEEP
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// SimulateVC takes a Vent, and Lung tuples, and returns pressure, flow, and volume values</span>
<span class="token keyword">func</span> <span class="token function">SimulateVC</span><span class="token punctuation">(</span>vent VentVC<span class="token punctuation">,</span> lung Lung<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	breathTime <span class="token operator">:=</span> <span class="token number">60.0</span> <span class="token operator">/</span> vent<span class="token punctuation">.</span>RR
	tau <span class="token operator">:=</span> lung<span class="token punctuation">.</span>Resistance <span class="token operator">*</span> lung<span class="token punctuation">.</span>Compliance
	volume<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> lung<span class="token punctuation">.</span>V0
	<span class="token comment">// calculate Ti (seconds) based on the flow wave shape</span>
	Ti <span class="token operator">:=</span> vent<span class="token punctuation">.</span>TV <span class="token operator">/</span> <span class="token punctuation">(</span>vent<span class="token punctuation">.</span>Flow <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> vent<span class="token punctuation">.</span>SqWave <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">{</span>
		Ti <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> vent<span class="token punctuation">.</span>TV <span class="token operator">/</span> <span class="token punctuation">(</span>vent<span class="token punctuation">.</span>Flow <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token comment">// for a decelarting wave, Ti is 2 * TV/F</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> t <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> dataPoints<span class="token number">-1</span><span class="token punctuation">;</span> t<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token comment">// calculate time</span>
		currentTime <span class="token operator">:=</span> <span class="token function">float64</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">*</span> dt
		timeInCycle <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Mod</span><span class="token punctuation">(</span>currentTime<span class="token punctuation">,</span> breathTime<span class="token punctuation">)</span>
		inspInCycle <span class="token operator">:=</span> timeInCycle <span class="token operator">&lt;</span> Ti
		time<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> currentTime
		<span class="token comment">// calculate flow</span>
		<span class="token keyword">if</span> inspInCycle <span class="token punctuation">{</span> <span class="token comment">// inspiration</span>
			<span class="token keyword">if</span> vent<span class="token punctuation">.</span>SqWave <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span> <span class="token comment">// square wave</span>
				flow<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> vent<span class="token punctuation">.</span>Flow <span class="token operator">/</span> <span class="token number">60</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// deceleration wave</span>
				flow<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>vent<span class="token punctuation">.</span>Flow <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> timeInCycle<span class="token operator">/</span>Ti<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			dv <span class="token operator">:=</span> flow<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">*</span> dt
			volume<span class="token punctuation">[</span>t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> volume<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">+</span> dv
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// expiration</span>
			dv <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">-</span>volume<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">/</span> tau<span class="token punctuation">)</span> <span class="token operator">*</span> dt <span class="token comment">// exponential decay formula in derivative form</span>
			volume<span class="token punctuation">[</span>t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> volume<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">+</span> dv
			flow<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> dv <span class="token operator">/</span> dt
		<span class="token punctuation">}</span>
		<span class="token comment">// calcualte Palv, and Paw</span>
		palv<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> volume<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">/</span>lung<span class="token punctuation">.</span>Compliance <span class="token operator">+</span> vent<span class="token punctuation">.</span>PEEP
		paw<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> flow<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">*</span>lung<span class="token punctuation">.</span>Resistance <span class="token operator">+</span> palv<span class="token punctuation">[</span>t<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">plotWaveforms</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Plotting airway, and alveolar pressure</span>
	p<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> plot<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	p<span class="token punctuation">.</span>X<span class="token punctuation">.</span>Label<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">"Time (seconds)"</span>
	p<span class="token punctuation">.</span>Y<span class="token punctuation">.</span>Label<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">"Pressure (cmH2o)"</span>
	pawPlot<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> plotter<span class="token punctuation">.</span><span class="token function">NewLine</span><span class="token punctuation">(</span><span class="token function">zipPoints</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> paw<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	palvPlot<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> plotter<span class="token punctuation">.</span><span class="token function">NewLine</span><span class="token punctuation">(</span><span class="token function">zipPoints</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> palv<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	palvPlot<span class="token punctuation">.</span>LineStyle<span class="token punctuation">.</span>Dashes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>vg<span class="token punctuation">.</span>Length<span class="token punctuation">{</span>vg<span class="token punctuation">.</span><span class="token function">Points</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vg<span class="token punctuation">.</span><span class="token function">Points</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
	p<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>pawPlot<span class="token punctuation">,</span> palvPlot<span class="token punctuation">)</span>
	p<span class="token punctuation">.</span>Legend<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"Airway Pressure"</span><span class="token punctuation">,</span> pawPlot<span class="token punctuation">)</span>
	p<span class="token punctuation">.</span>Legend<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"Alveolar Pressure"</span><span class="token punctuation">,</span> palvPlot<span class="token punctuation">)</span>
	p<span class="token punctuation">.</span>Legend<span class="token punctuation">.</span>Top <span class="token operator">=</span> <span class="token boolean">true</span>
	p<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">*</span>vg<span class="token punctuation">.</span>Inch<span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">*</span>vg<span class="token punctuation">.</span>Inch<span class="token punctuation">,</span> FILENAME<span class="token operator">+</span><span class="token string">"Pressure.png"</span><span class="token punctuation">)</span>
	<span class="token comment">// Plotting flow</span>
	p<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> plot<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	p<span class="token punctuation">.</span>X<span class="token punctuation">.</span>Label<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">"Time (seconds)"</span>
	p<span class="token punctuation">.</span>Y<span class="token punctuation">.</span>Label<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">"Flow (liters per second)"</span>
	flowPoints<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> plotter<span class="token punctuation">.</span><span class="token function">NewLine</span><span class="token punctuation">(</span><span class="token function">zipPoints</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> flow<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	p<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>flowPoints<span class="token punctuation">)</span>
	p<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">*</span>vg<span class="token punctuation">.</span>Inch<span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">*</span>vg<span class="token punctuation">.</span>Inch<span class="token punctuation">,</span> FILENAME<span class="token operator">+</span><span class="token string">"Flow.png"</span><span class="token punctuation">)</span>
	<span class="token comment">// Plotting volume</span>
	p<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> plot<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	p<span class="token punctuation">.</span>X<span class="token punctuation">.</span>Label<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">"Time (seconds)"</span>
	p<span class="token punctuation">.</span>Y<span class="token punctuation">.</span>Label<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">"Volume (liters)"</span>
	volumePoints<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> plotter<span class="token punctuation">.</span><span class="token function">NewLine</span><span class="token punctuation">(</span><span class="token function">zipPoints</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> volume<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	p<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>volumePoints<span class="token punctuation">)</span>
	p<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">*</span>vg<span class="token punctuation">.</span>Inch<span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">*</span>vg<span class="token punctuation">.</span>Inch<span class="token punctuation">,</span> FILENAME<span class="token operator">+</span><span class="token string">"Volume.png"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">zipPoints</span><span class="token punctuation">(</span>xs <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> ys <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">)</span> plotter<span class="token punctuation">.</span>XYs <span class="token punctuation">{</span>
	n <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span>
	pts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span>plotter<span class="token punctuation">.</span>XYs<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>X <span class="token operator">=</span> xs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
		pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Y <span class="token operator">=</span> ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
	pts<span class="token punctuation">[</span>n<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>X <span class="token operator">=</span> xs<span class="token punctuation">[</span>n<span class="token number">-2</span><span class="token punctuation">]</span>
	pts<span class="token punctuation">[</span>n<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Y <span class="token operator">=</span> ys<span class="token punctuation">[</span>n<span class="token number">-2</span><span class="token punctuation">]</span>
	<span class="token keyword">return</span> pts
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">updateParameters</span><span class="token punctuation">(</span>input <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> s <span class="token operator">:=</span> <span class="token keyword">range</span> input <span class="token punctuation">{</span>
		keyValue <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">)</span>
		key <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>keyValue<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">switch</span> key <span class="token punctuation">{</span>
		<span class="token keyword">case</span> <span class="token string">"MODE"</span><span class="token punctuation">:</span>
			MODE <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>keyValue<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">case</span> <span class="token string">"FILENAME"</span><span class="token punctuation">:</span>
			FILENAME <span class="token operator">=</span> keyValue<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
		<span class="token keyword">default</span><span class="token punctuation">:</span>
			value<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseFloat</span><span class="token punctuation">(</span>keyValue<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
			PARS<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">generateWaveforms</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	lung <span class="token operator">:=</span> Lung<span class="token punctuation">{</span>PARS<span class="token punctuation">[</span><span class="token string">"R"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> PARS<span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> PARS<span class="token punctuation">[</span><span class="token string">"V0"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
	<span class="token keyword">switch</span> MODE <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token string">"VC"</span><span class="token punctuation">:</span>
		vent <span class="token operator">:=</span> VentVC<span class="token punctuation">{</span>PARS<span class="token punctuation">[</span><span class="token string">"RR"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> PARS<span class="token punctuation">[</span><span class="token string">"TV"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> PARS<span class="token punctuation">[</span><span class="token string">"FLOW"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> PARS<span class="token punctuation">[</span><span class="token string">"SQWAVE"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> PARS<span class="token punctuation">[</span><span class="token string">"PEEP"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
		<span class="token function">SimulateVC</span><span class="token punctuation">(</span>vent<span class="token punctuation">,</span> lung<span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token string">"PC"</span><span class="token punctuation">:</span>
		vent <span class="token operator">:=</span> VentPC<span class="token punctuation">{</span>PARS<span class="token punctuation">[</span><span class="token string">"RR"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> PARS<span class="token punctuation">[</span><span class="token string">"PI"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> PARS<span class="token punctuation">[</span><span class="token string">"TI"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> PARS<span class="token punctuation">[</span><span class="token string">"PEEP"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
		<span class="token function">SimulatePC</span><span class="token punctuation">(</span>vent<span class="token punctuation">,</span> lung<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token function">plotWaveforms</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{</span>
		<span class="token function">updateParameters</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token function">generateWaveforms</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>helpMessage<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
</body>

</html>
